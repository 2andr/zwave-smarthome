<!-- Events view -->
<div ng-controller="EventController">
    <bb-loader></bb-loader>
    <div class="page-control form-inline">
        <div class="btn-group">
            <button class="btn btn-default" ng-click="expandNavi('evDay', $event)" ng-switch="timeFilter.day">
                <i class="fa fa-calendar-check-o"></i> 
                 <span ng-switch-when="2">{{_t('lb_yesterday')}}</span>
                 <span ng-switch-when="7">7 {{_t('lb_days')}}</span>
                <span ng-switch-default>{{_t('lb_today')}}</span>
            </button>
            <div class="app-dropdown" ng-if="naviExpanded.evDay">
                <ul>
                    <li class="page-order-1" ng-class="timeFilter.day == 1 ? 'active': ''" ng-click="changeTime(1)">
                        <a href="">{{_t('lb_today')}} <span class="menu-arrow" ng-if="timeFilter.day == 1"><i class="fa fa-check"></i></span></a>
                    </li>
                    <li class="page-order-2" ng-class="timeFilter.day == 2 ? 'active': ''" ng-click="changeTime(2)">
                        <a href="">{{_t('lb_yesterday')}} <span class="menu-arrow" ng-if="timeFilter.day == 2"><i class="fa fa-check"></i></span></a>
                    </li>
                    <li class="page-order-7" ng-class="timeFilter.day == 7 ? 'active': ''" ng-click="changeTime(7)">
                        <a href="">7 {{_t('lb_days')}} <span class="menu-arrow" ng-if="timeFilter.day == 7"><i class="fa fa-check"></i></span></a>
                    </li>
                </ul>
            </div>
        </div>
         <div class="btn-group">
        <button class="btn btn-default" ng-click="expandNavi('evFilter', $event)">
                <i class="fa fa-filter"></i>
                <span ng-if="!devices.find.title && !currLevel">{{_t('lb_show_all')}}</span>
                 <span ng-if="devices.find.title">{{_t(devices.find.title) | cutText:true:25}}</span>
                 <span ng-if="currLevel"> {{_t('lb_notify_' + currLevel)}}</span>
            </button>
         </div>
    </div>
    <div class="page-navi" ng-if="naviExpanded.evFilter">
        <div class="page-navi-in">
             <p class="page-navi-title">{{_t('error_type')}} </p>
            <div class="page-navi-content">
                 <a class="page-navi-tag" ng-href="#events/level/{{v.key}}" ng-repeat="v in eventLevels" ng-class="v.key == currLevel? 'active': ''">
                     {{_t('lb_notify_' + v.val)}}
                 </a>
            </div>
            <p class="page-navi-title">{{_t('lb_device')}} </p>
            <div class="page-navi-content">
                 
                 <a class="page-navi-tag" ng-href="#events/source/{{v.id}}" ng-repeat="v in devices.data" ng-class="v.id===devices.find.id ? 'active':''">
                      <img class="report-img" ng-src="{{v.metrics.icon|getElementIcon:v:v.metrics.level}}" alt="img" />
                                        {{v.metrics.title|cutText:true:25}}
                 </a>
            </div>
            
        </div>
    </div>
      <div class="info-lert" ng-if="collection.length < 1 || devices.find.id"><i class="fa fa-info-circle text-info"></i> {{_t('device_no_event')}}.</div>
    <div class="table-responsive_">
        <table class="table table-condensed table-report table-events">
            <tbody>
                <tr class="td-event-{{v.level}}" dir-paginate="v in collection | orderBy: '-timestamp' | itemsPerPage: pageSize" current-page="currentPage" id="row_{{v.id}}">

                    <td class="td-event-icon td-event-{{v.level}}">
                        <img id="event_img_{{v.id}}" class="report-img" ng-src="storage/img/events/{{v.type|getEventIcon:v.message}}" alt="{{v.type}}"/>

                    </td>
                    <td>
                        <span class="text-supp event-date" title="{{v.timestamp| date:'dd.MM.yyyy H:mm'}}" ng-bind="v.timestamp | eventDate"></span> <span class="hide-on-mobile">|</span>
                        <span  ng-if="v.source && v.message">
                        <a ng-href="#element/{{v.source}}" ng-if="elementAccess(cfg.role_access.element) && (cfg.events_clickable.indexOf(v.level) > -1)">
                            <span ng-if="v.message | hasNode:'l'"> <span ng-bind="v.message.dev"></span> {{_t('lb_is')}} <strong ng-bind="v.message.l"></strong></span>
                            <span ng-if="!(v.message | hasNode:'l')" ng-bind="v.message"></span>
                         </a>
                         <span  ng-if="!elementAccess(cfg.role_access.element) || (cfg.events_clickable.indexOf(v.level) === -1)">
                            <span ng-if="v.message | hasNode:'l'"> <span ng-bind="v.message.dev"></span> {{_t('lb_is')}} <strong ng-bind="v.message.l"></strong></span>
                            <span ng-if="!(v.message | hasNode:'l')" ng-bind="v.message"></span>
                         </span>
                         </span>
                        <span class="report-message" ng-bind="v.message" ng-if="!v.source && !v.message"></span>
                    </td>
                    <td class="td-action">
                        <div class="btn-group">
                            <button type="button" class="btn btn-default" ng-click="expandNavi('evDropDown_' + $index, $event)"><i class="fa fa-caret-down"></i></button>
                            <div class="app-dropdown" ng-if="naviExpanded['evDropDown' + '_' + $index]">
                            <ul>
                                <li>
                                    <a ng-href="#events"> <i class="fa fa-eye"></i> <span ng-bind="_t('lb_show_all')"></span></a>
                                </li>
                                <li>
                                    <a ng-href="#events/source/{{v.source}}"><i class="fa fa-check"></i> <span ng-bind="_t('lb_events_source')"></span></a>
                                </li> 
                                <li>
                                    <a ng-href="#events/type/{{v.type}}"><i class="fa fa-check-square"></i> <span ng-bind="_t('lb_events_type')"></span></a>
                                </li> 
                                <li>
                                    <a ng-href="#events/source_type?source={{v.source}}&type={{v.type}}">
                                        <i class="fa fa-check-circle"></i> <span ng-bind="_t('lb_events_source_type')"></span>
                                    </a>
                                </li>
                                <li ng-if="elementAccess(cfg.role_access.element) && (cfg.events_clickable.indexOf(v.level) > -1) && (v.source && v.message)">
                                    <a href="#element/{{v.source}}">
                                        <i class="fa fa-cog"></i> <span ng-bind="_t('lb_source_cfg')"></span>   
                                    </a>
                                </li> 
                                <li>

                                    <a href="" ng-click="hideSourceEvents(v.source)" 
                                       ng-if="user.hide_single_device_events.indexOf(v.source) === -1">
                                        <i class="fa fa-minus-circle text-danger"></i> <span  ng-bind="_t('lb_hide_events_source')" ></span>
                                    </a>
                                </li>
                                <li ng-if="elementAccess(cfg.role_access.event_delete)">
                                    <a href=""ng-click="deleteEvent(v.id, '?uid=' + v.h, '#row_' + v.id,_t('lb_delete_confirm'))" ng-if="v.level == 'error' || v.level == 'notification'">
                                        <i class="fa fa-times text-danger"></i> <span  ng-bind="_t('lb_delete_event')" ></span>
                                    </a>
                                </li>

                            </ul>
                           </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="info-lert" ng-if="user.hide_all_device_events || user.hide_system_events"><i class="fa fa-info-circle text-info"></i> <span ng-bind="_t('events_hidden')"></span></div>
        <div class="text-center mobile-padding" ng-if="collection.length > 0">
            <dir-pagination-controls boundary-links="true"></dir-pagination-controls>
        </div>
    </div>
</div> <!-- /ng-controller --> 