<div ng-controller="ZigbeeManageDetailController" class="mobile-padding">
    <bb-loader></bb-loader> 
    <!-- Enocean navigation -->
    <div ng-include="'app/views/zigbee/navi.html'"></div>
    <div ng-show="formInput.show">
        <h1>{{ZigbeeDevice.title}}</h1>
        <!-- Zigbee config form -->
        <!--<pre>{{formInput | json }}</pre>-->
        <form name="form_network_config" id="form_network_config" class="form form-page" ng-submit="updateAllDevices(formInput)" novalidate>
            <div ng-if="devices.length > 0">
                <fieldset>
                    <!-- Add room -->
                    <div class="form-group form-inline">
                        <div class="input-group">
                            <input name="appstore_token" id="appstore_token" class="form-control" placeholder="{{_t('lb_add_room')}}" ng-model="formInput.newRoom" /> 
                           <span class="input-group-addon clickable" title="{{_t('add_new')}}" ng-click="addRoom(formInput.newRoom)">
                               <i class="fa fa-plus text-success"></i>
                           </span> 
                        </div>
                    </div>
                    <!-- Rooms -->
                    <div class="form-group form-inline">
                        <label class="display-block" ng-bind="_t('devices_to_room')"></label>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default" 
                                    ng-click="expandNavi('devidDropDown', $event)">
                                {{rooms[formInput.room].title|cutText:true:20}} <i class="fa fa-caret-down"></i>
                            </button>
                            <div class="app-dropdown app-dropdown-left" ng-if="naviExpanded.devidDropDown">
                                <ul>
                                    <li class="clickable" 
                                        ng-click="formInput.room = v.id"
                                        ng-repeat="v in rooms">
                                        <a>
                                            <img class="navi-img" ng-src="{{v.img_src}}" alt="img" /> 
                                            {{v.title|cutText:true:20}} <i class="fa fa-check menu-arrow" ng-if="formInput.room == v.id"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <div class="form-group form-inline zigbee-hidden-{{formInput.elements[e.id].permanently_hidden}}" ng-repeat="e in devices| orderBy:'title':false track by e.id" ng-init="dev[e.id] = e">
                        <ng-form name="subForm">
                            <h3>
                                <img class="report-img-s" ng-src="{{e.iconPath}}" alt="img" /> 
                                <span ng-bind="formInput.elements[e.id].metrics.title"></span>
                            </h3>
                            <div class="form-group form-inline">
                                <input type="text" name="title" id="title" class="form-control" ng-model="formInput.elements[e.id].metrics.title" value="{{formInput.elements[e.id].metrics.title}}" ng-blur="titleBlur = true" ng-required="true"/>
                                <span class="mobile-block">
                                    <input type="checkbox" name="permanently_hidden_{{$index}}" id="permanently_hidden_{{$index}}" ng-model="formInput.elements[e.id].permanently_hidden" ng-checked="formInput.elements[e.id].permanently_hidden" />
                                    <label for="permanently_hidden_{{$index}}">{{_t('lb_deactivate')}}</label>
                                </span>
                                <bb-validator input-name="subForm.title.$error.required" trans='_t("field_required")' has-blur='titleBlur'></bb-validator>
                            </div>
                        </div>
                    </ng-form>
                </fieldset>
            </div>
            <fieldset class="submit-entry">
                <button type="button" class="btn btn-default" title="{{_t('lb_cancel')}}" ng-if="!nohistory" bb-go-back>
                    <i class="fa fa-reply"></i> <span class="btn-name">{{_t('lb_cancel')}}</span>
                </button>
                <button type="submit" class="btn btn-submit" title="{{_t('lb_save')}}" ng-disabled="form_network_config.$invalid">
                    <i class="fa fa-check"></i> <span class="btn-name">{{_t('lb_save')}}</span>
                </button>

            </fieldset>
        </form>
    </div>
    <div class="device-logo" ng-include="'app/views/zigbee/zigbee_nav.html'"></div>
</div> <!-- /ng-controller --> 

